<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.bonfire.mapper.TripPlanMapper">
    <insert id="addPlan" parameterType="java.util.List">
        <foreach collection="list" item="vo" open="insert all">
            into tripplan values(#{vo.idx}, #{vo.id}, #{vo.placeid}, #{vo.triporder})
        </foreach>
    </insert>
    <select id="getIndex">
        select max(idx) idx from tripplan
    </select>
    <select id="getIdxByUser" resultType="int" parameterType="string">
        select distinct idx from tripplan where id=#{id}
    </select>
    <select id="getPlanIdxByIdx" resultType="tripplan">
        select idx, id, placeid, triporder from tripplan where idx=#{idx}
    </select>
    <select id="getPlanMapByIdx" parameterType="int" resultType="localmap">
        select 
            TYPE, 
            GEOMETRYTYPE, 
            GEOMETRYCOORDINATESLNG, 
            GEOMETRYCOORDINATESLAT, 
            PROPERTIESADDRESS_NAME, 
            PROPERTIESCATEGORY_GROUP_CODE, 
            PROPERTIESCATEGORY_GROUP_NAME, 
            PROPERTIESCATEGORY_NAME, 
            PROPERTIESDISTANCE, 
            PROPERTIESID, 
            PROPERTIESPHONE, 
            PROPERTIESPLACE_NAME, 
            PROPERTIESPLACE_URL, 
            PROPERTIESROAD_ADDRESS_NAME
        from tripplan t, localmap l 
        where t.placeid=l.propertiesid and t.idx=#{idx}
    </select>

</mapper>